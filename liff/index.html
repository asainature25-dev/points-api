<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ポイント残高</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="font-family: sans-serif; padding: 16px;">
  <h2>ポイント残高</h2>
  <button id="checkoutBtn" style="margin:12px 0; padding:10px 14px; border-radius:10px;">
  月額9,900円で登録（決済へ）
</button>
  <div id="state">起動中...</div>
  <pre id="out" style="background:#f5f5f5;padding:12px;border-radius:8px;white-space:pre-wrap;"></pre>

  <script>
    const LIFF_ID = "2009265721-v5XUFK45"; // ←ここだけ後で差し替え

    async function main() {
      try {
        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        // 決済ボタン
document.getElementById("checkoutBtn").onclick = async () => {
  const res = await fetch("https://points-api.pages.dev/api/stripe/create-checkout", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ line_user_id: profile.userId }),
  });

  const data = await res.json();

  if (data.url) {
    location.href = data.url; // Stripeへ飛ぶ
  } else {
    alert("create-checkout error: " + JSON.stringify(data));
  }s
};
        document.getElementById("state").textContent = "取得中...";
        document.getElementById("out").textContent =
          "line_user_id: " + profile.userId + "\n" +
          "displayName: " + profile.displayName;

        const res = await fetch(`/api/points/balance-line?line_user_id=${encodeURIComponent(profile.userId)}`);
        const json = await res.json();

        document.getElementById("state").textContent = "結果";
        document.getElementById("out").textContent += "\n\n" + JSON.stringify(json, null, 2);
      } catch (e) {
        document.getElementById("state").textContent = "エラー";
        document.getElementById("out").textContent = String(e);
      }
    }

    main();
  </script>
</body>
</html>